<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A3â†’A4 PDFåˆ†å‰²ãƒ„ãƒ¼ãƒ«</title>
    <meta name="description" content="A3ã‚µã‚¤ã‚ºã®PDFã‚’A4ã‚µã‚¤ã‚ºã«åˆ†å‰²ãƒ»ä¸¦ã³æ›¿ãˆã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³">
    <meta name="keywords" content="PDF,åˆ†å‰²,A3,A4,è£½æœ¬,å¾©å…ƒ,å¤‰æ›">
    <meta name="author" content="A3â†’A4 PDFåˆ†å‰²ãƒ„ãƒ¼ãƒ«">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icons/icon-152x152.png') }}">
    <link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='icons/icon-16x16.png') }}">

    <!-- Theme Colors -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-navbutton-color" content="#667eea">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="PDFåˆ†å‰²">

    <!-- Windows PWA Meta Tags -->
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='icons/icon-144x144.png') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“„ A3â†’A4 PDFåˆ†å‰²ãƒ„ãƒ¼ãƒ«</h1>
            <p class="subtitle">A3ã‚µã‚¤ã‚ºã®PDFã‚’A4ã‚µã‚¤ã‚º2ãƒšãƒ¼ã‚¸ã«åˆ†å‰²ã—ã¾ã™</p>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <main>
            <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“¤</div>
                    <p class="upload-text">PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                    <p class="upload-text-sub">ã¾ãŸã¯</p>
                    <label for="fileInput" class="file-label">
                        ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                    </label>
                    <input type="file" name="file" id="fileInput" accept=".pdf" required>
                    <p class="file-info" id="fileInfo"></p>
                </div>

                <div class="mode-selection">
                    <h3>å‡¦ç†ãƒ¢ãƒ¼ãƒ‰</h3>
                    <div class="mode-group">
                        <label class="mode-label">
                            <input type="radio" name="mode" value="simple" id="modeSimple" checked>
                            <div class="mode-card">
                                <div class="mode-icon">ğŸ“„</div>
                                <div class="mode-title">ã‚·ãƒ³ãƒ—ãƒ«åˆ†å‰²</div>
                                <div class="mode-description">A3ã‚’å·¦å³ã«åˆ†å‰²ã—ã¦A4ã‚’2ãƒšãƒ¼ã‚¸ä½œæˆ</div>
                            </div>
                        </label>
                        <label class="mode-label">
                            <input type="radio" name="mode" value="booklet" id="modeBooklet">
                            <div class="mode-card">
                                <div class="mode-icon">ğŸ“–</div>
                                <div class="mode-title">è£½æœ¬å¾©å…ƒ</div>
                                <div class="mode-description">ä¸­ç¶´ã˜è£½æœ¬ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸPDFã‚’æ­£ã—ã„ãƒšãƒ¼ã‚¸é †ã«å¾©å…ƒ</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="options">
                    <h3>ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š</h3>

                    <!-- Simple mode options -->
                    <div class="simple-options" id="simpleOptions">
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="vertical" id="vertical">
                                <span>ç¸¦æ›¸ããƒ¢ãƒ¼ãƒ‰ï¼ˆå³â†’å·¦ã®é †åºï¼‰</span>
                            </label>
                        </div>
                    </div>

                    <!-- Booklet mode options -->
                    <div class="booklet-options" id="bookletOptions" style="display: none;">
                        <div class="option-group">
                            <label class="input-label">
                                <span>ç·A4ãƒšãƒ¼ã‚¸æ•°ï¼ˆç©ºç™½ã§è‡ªå‹•æ¤œå‡ºï¼‰</span>
                                <input type="number" name="total_pages" id="totalPages" min="4" step="4" placeholder="32">
                                <small>â€»4ã®å€æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                            </label>
                        </div>
                    </div>

                    <!-- Common options -->
                    <div class="common-options">
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="rotate" id="rotate">
                                <span>90åº¦å›è»¢</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="submit-area">
                    <button type="submit" class="submit-btn" id="submitBtn" disabled>
                        <span class="btn-text">PDFã‚’åˆ†å‰²</span>
                        <span class="spinner" id="spinner"></span>
                    </button>
                </div>
            </form>

            <div class="info-section">
                <h3>ä½¿ã„æ–¹</h3>
                <ol>
                    <li>A3ã‚µã‚¤ã‚ºã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</li>
                    <li>å‡¦ç†ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠï¼ˆã‚·ãƒ³ãƒ—ãƒ«åˆ†å‰² or è£½æœ¬å¾©å…ƒï¼‰</li>
                    <li>å¿…è¦ã«å¿œã˜ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š</li>
                    <li>ã€ŒPDFã‚’åˆ†å‰²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>å‡¦ç†ã•ã‚ŒãŸA4ã‚µã‚¤ã‚ºã®PDFãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™</li>
                </ol>

                <h3>å‡¦ç†ãƒ¢ãƒ¼ãƒ‰èª¬æ˜</h3>
                <div class="mode-info">
                    <div class="mode-detail">
                        <h4>ğŸ“„ ã‚·ãƒ³ãƒ—ãƒ«åˆ†å‰²</h4>
                        <p>A3ãƒšãƒ¼ã‚¸ã‚’å˜ç´”ã«å·¦å³ã«åˆ†å‰²ã—ã¦A4ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
                        <p>ä¾‹: A3ãƒšãƒ¼ã‚¸1 â†’ A4ãƒšãƒ¼ã‚¸1,2</p>
                    </div>
                    <div class="mode-detail">
                        <h4>ğŸ“– è£½æœ¬å¾©å…ƒ</h4>
                        <p>ä¸­ç¶´ã˜è£½æœ¬ã•ã‚ŒãŸA3è³‡æ–™ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸPDFã‚’ã€å…ƒã®èª­ã¿é †ã«å¾©å…ƒã—ã¾ã™ã€‚</p>
                        <p>ä¾‹: ãƒ›ãƒƒãƒã‚­ã‚¹è£½æœ¬ã•ã‚ŒãŸå†Šå­ã®ãƒšãƒ¼ã‚¸é †ã‚’æ­£ã—ãä¸¦ã³æ›¿ãˆ</p>
                    </div>
                </div>

                <h3>ä»•æ§˜</h3>
                <ul>
                    <li>æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 50MB</li>
                    <li>å¯¾å¿œå½¢å¼: PDFã®ã¿</li>
                    <li>A3ã®1ãƒšãƒ¼ã‚¸ â†’ A4ã®2ãƒšãƒ¼ã‚¸ã«åˆ†å‰²</li>
                    <li>è£½æœ¬å¾©å…ƒãƒ¢ãƒ¼ãƒ‰ã§ã¯ä»»æ„ã®ãƒšãƒ¼ã‚¸æ•°ã«å¯¾å¿œï¼ˆ4ã®å€æ•°æ¨å¥¨ï¼‰</li>
                </ul>
            </div>
        </main>

        <footer>
            <p>Â© 2024 A3â†’A4 PDFåˆ†å‰²ãƒ„ãƒ¼ãƒ«</p>
        </footer>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const submitBtn = document.getElementById('submitBtn');
        const uploadArea = document.getElementById('uploadArea');
        const uploadForm = document.getElementById('uploadForm');
        const spinner = document.getElementById('spinner');
        const modeSimple = document.getElementById('modeSimple');
        const modeBooklet = document.getElementById('modeBooklet');
        const simpleOptions = document.getElementById('simpleOptions');
        const bookletOptions = document.getElementById('bookletOptions');

        // Mode switching
        function toggleModeOptions() {
            if (modeBooklet.checked) {
                simpleOptions.style.display = 'none';
                bookletOptions.style.display = 'block';
            } else {
                simpleOptions.style.display = 'block';
                bookletOptions.style.display = 'none';
            }
        }

        modeSimple.addEventListener('change', toggleModeOptions);
        modeBooklet.addEventListener('change', toggleModeOptions);

        // File selection
        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                fileInfo.textContent = `é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ${file.name} (${formatFileSize(file.size)})`;
                submitBtn.disabled = false;
                uploadArea.classList.add('has-file');
            }
        });

        // Drag and drop
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');

            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                if (file.type === 'application/pdf') {
                    fileInput.files = e.dataTransfer.files;
                    fileInfo.textContent = `é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ${file.name} (${formatFileSize(file.size)})`;
                    submitBtn.disabled = false;
                    uploadArea.classList.add('has-file');
                } else {
                    alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™');
                }
            }
        });

        // Form submission
        uploadForm.addEventListener('submit', function(e) {
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            spinner.style.display = 'inline-block';
        });

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return Math.round(bytes / 1024) + ' KB';
            else return Math.round(bytes / 1048576) + ' MB';
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            deferredPrompt = e;

            // Show install button/banner
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // Create install banner
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: center; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
                    <span style="margin-right: 15px;">ğŸ“± ã“ã®ã‚¢ãƒ—ãƒªã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã§ãã¾ã™</span>
                    <button id="installBtn" style="background: white; color: #667eea; border: none; padding: 8px 16px; border-radius: 20px; font-weight: 600; cursor: pointer; margin-right: 10px;">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
                    <button id="dismissBtn" style="background: transparent; color: white; border: 1px solid white; padding: 8px 16px; border-radius: 20px; cursor: pointer;">å¾Œã§</button>
                </div>
            `;

            document.body.appendChild(installBanner);

            // Install button click handler
            document.getElementById('installBtn').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                        installBanner.remove();
                    });
                }
            });

            // Dismiss button click handler
            document.getElementById('dismissBtn').addEventListener('click', () => {
                installBanner.remove();
            });
        }

        // PWA Install Success
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA was installed');
        });
    </script>
</body>
</html>